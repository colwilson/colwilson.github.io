<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="Notes on my coding adventures"><meta name="keywords" content="node, nodejs, python, vue2"><title>A Simple Feathers Real-Time Example - Profound</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"><!-- Google Tag Manager--><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-57W46GL');</script><!-- End Google Tag Manager--><meta name="google-site-verification" content="v1EWNN8vHNv61dO6FeITdiiC6UxgKHE5jP5n2Gn9_cU"></head><body><!-- Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57W46GL" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript><!-- End Google Tag Manager (noscript)--><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><!-- Profound Main--><ins class="adsbygoogle" style="display:block;" data-ad-client="ca-pub-8143086736444913" data-ad-slot="6156751424" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/cow-w.jpg"><div class="post-title"><h1 class="title">A Simple Feathers Real-Time Example</h1><ul class="meta"><li><i class="icon icon-author"></i>Col Wilson</li><li><i class="icon icon-clock"></i>22 Minutes</li><li><i class="icon icon-calendar"></i>April 2, 2017</li></ul></div></div><div class="article-content" style="max-width:800px"><p>In my <a href="../feathers-services-with-leveldb-backends">tutorial on using LevelDB backends with Feathers</a> I said I’d illustrate the real-time capabilities of Feathers later. The <a href="https://en.wikipedia.org/wiki/Real-time_database" target="_blank" rel="external">Wikipedia Article on Real-Time Databases</a> quotes Buchmann in saying</p>
<blockquote>
<p>A real-time database is a database system which uses real-time processing to handle workloads whose state is constantly changing.</p>
<p>– <cite>Buchmann, A. “Real Time Database Systems.” Encyclopedia of Database Technologies and Applications. 2005</cite></p>
</blockquote>
<p>What we mean by real-time in this tutorial is the ability to share data across multiple potentially disparate clients. In other words, when the database is updated, the data on the client is updated without necessarily having to resubmit a query.</p>
<p>Below I’ll try to illustrate his by using:</p>
<ul>
<li>A Feathers instance backed by a simple, in-memory data store.</li>
<li>A really simple and real-time data provider (providing really stupid data)</li>
<li>A <a href="https://vuejs.org/2016/04/27/announcing-2.0/" target="_blank" rel="external">Vue2</a> client app running on multiple browsers.</li>
</ul>
<h2 id="The-Feathers-Instance"><a href="#The-Feathers-Instance" class="headerlink" title="The Feathers Instance"></a>The Feathers Instance</h2><p>We’ll use the really stupid <em>nicknames</em> service which I should you how to set up in <a href="../feathers-services-with-leveldb-backends">Configuring Feathers Services To Use LevelDB Backends - Part 1</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm install -g feathers-cli</div><div class="line"></div><div class="line">mkdir feathers_realtime_1; <span class="built_in">cd</span> <span class="variable">$_</span></div><div class="line">feathers generate <span class="comment"># use all the default options</span></div></pre></td></tr></table></figure>
<p>Still inside the CLI, create the <em>nicknames</em> service:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">generate service</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">? What do you want to call your service? nicknames</div><div class="line">? What type of service do you need? generic</div><div class="line">? Does your service require users to be authenticated? No</div><div class="line">   create src/services/nicknames/index.js</div><div class="line">   create src/services/nicknames/hooks/index.js</div><div class="line">   create test/services/nicknames/index.test.js</div><div class="line"></div><div class="line"></div><div class="line">exit # exit the CLI</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install levelup feathers-levelup memdown --save</div></pre></td></tr></table></figure>
<p>and then use your preferred editor to edit the service file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">atom ./src/services/nicknames/index.js</div></pre></td></tr></table></figure>
<p>Replace eveything in the index file with:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> hooks = <span class="built_in">require</span>(<span class="string">'./hooks'</span>);</div><div class="line"></div><div class="line"><span class="keyword">const</span> level = <span class="built_in">require</span>(<span class="string">'levelup'</span>);</div><div class="line"><span class="keyword">const</span> memdown = <span class="built_in">require</span>(<span class="string">'memdown'</span>);</div><div class="line"><span class="keyword">const</span> featherup = <span class="built_in">require</span>(<span class="string">'feathers-levelup'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">const</span> app = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">  <span class="keyword">const</span> db = level(memdown, &#123; <span class="comment">// in memory store</span></div><div class="line">    valueEncoding: <span class="string">'json'</span></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">const</span> service = featherup(&#123; <span class="attr">db</span>: db &#125;)</div><div class="line">  <span class="comment">// Initialize our service with any options it requires</span></div><div class="line">  <span class="comment">// app.use('/nicknames', new Service());</span></div><div class="line">  app.use(<span class="string">'/nicknames'</span>, service)</div><div class="line"></div><div class="line">  <span class="comment">// Get our initialize service to that we can bind hooks</span></div><div class="line">  <span class="keyword">const</span> nicknamesService = app.service(<span class="string">'/nicknames'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Set up our before hooks</span></div><div class="line">  nicknamesService.before(hooks.before);</div><div class="line"></div><div class="line">  <span class="comment">// Set up our after hooks</span></div><div class="line">  nicknamesService.after(hooks.after);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>Now, start the service:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm start</div></pre></td></tr></table></figure></p>
<h2 id="Load-up-some-stupid-data"><a href="#Load-up-some-stupid-data" class="headerlink" title="Load up some stupid data"></a>Load up some stupid data</h2><p>In a seperate <a href="../a-very-simple-http-post-tool">post</a>, I’ve written a really stupid data provider for this tutorial.</p>
<p>Open a seperate console and start it up:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir poster; <span class="built_in">cd</span> <span class="variable">$_</span></div><div class="line">npm install cron http-post faker nicknames --save</div><div class="line">wget https://www.wwwdotcomslash.com/downloads/poster.js</div><div class="line">node poster.js</div></pre></td></tr></table></figure>
<p>Open another console and give it a couple of seconds and you should see some data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl http://localhost:3030/nicknames | python -m json.tool</div></pre></td></tr></table></figure>
<h2 id="Create-the-Vue2-app"><a href="#Create-the-Vue2-app" class="headerlink" title="Create the Vue2 app"></a>Create the Vue2 app</h2><p>First, we install the Vue2 CLI and then use it to create our app:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">npm install --global vue-cli</div><div class="line"></div><div class="line">vue init webpack nicknames_app <span class="comment"># use all the defaults</span></div><div class="line"></div><div class="line"><span class="built_in">cd</span> nicknames_app</div><div class="line">npm install</div><div class="line">npm install vue-feathers vue-syncers-feathers --save</div><div class="line">npm run dev</div></pre></td></tr></table></figure></p>
<p>Then use your preferred editor to edit the routes file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">atom src/router/index.js</div></pre></td></tr></table></figure>
<p>We’re changing almost the whole file here, but if you look at the imports we are adding and how they are used, it should be reasonably clear what’s going on. Essentially we get rid of the old demo component and add a <em>Nicknames</em> one which can use the magic of Feathers over sockets.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></div><div class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></div><div class="line"><span class="keyword">import</span> Nicknames <span class="keyword">from</span> <span class="string">'@/components/Nicknames'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> feathers <span class="keyword">from</span> <span class="string">'feathers/client'</span></div><div class="line"><span class="keyword">import</span> socketio <span class="keyword">from</span> <span class="string">'feathers-socketio/client'</span></div><div class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">'socket.io-client'</span></div><div class="line"><span class="keyword">import</span> VueSyncersFeathers <span class="keyword">from</span> <span class="string">'vue-syncers-feathers'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> hooks = <span class="built_in">require</span>(<span class="string">'feathers-hooks'</span>)</div><div class="line"><span class="keyword">const</span> socket = io(<span class="string">'http://localhost:3030'</span>)</div><div class="line"><span class="keyword">const</span> client = feathers().configure(hooks()).configure(socketio(socket))</div><div class="line"></div><div class="line">Vue.use(Router)</div><div class="line">Vue.use(VueSyncersFeathers, &#123; <span class="attr">feathers</span>: client &#125;)</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</div><div class="line">  <span class="attr">routes</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">path</span>: <span class="string">'/'</span>,</div><div class="line">      <span class="attr">name</span>: <span class="string">'Nicknames'</span>,</div><div class="line">      <span class="attr">component</span>: Nicknames</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>We’re all set, so we can now edit the <em>Nicknames</em> component to see some actual data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">atom src/components/Nicknames.vue</div></pre></td></tr></table></figure>
<p>Replace the content with:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-for</span>=<span class="string">"item in nicknames"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;item.name&#125;&#125; (&#123;&#123;item.nickname&#125;&#125;)<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">sync</span>: &#123;</div><div class="line">    <span class="attr">nicknames</span>: &#123;</div><div class="line">      <span class="attr">service</span>: <span class="string">'nicknames'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>If you view this in a browser at <a href="http://localhost:8080/Nicknames" target="_blank" rel="external">http://localhost:8080/Nicknames</a> you’ll see a long list of names which is updating everytime the silly data gets inserted.</p>
<p>To be able to see the changing data better, the code below is very slightly refined to only see the last five insertions.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-for</span>=<span class="string">"item in last5"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;item.name&#125;&#125; (&#123;&#123;item.nickname&#125;&#125;)<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">sync</span>: &#123;</div><div class="line">    <span class="attr">nicknames</span>: &#123;</div><div class="line">      <span class="attr">service</span>: <span class="string">'nicknames'</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">computed</span>: &#123;</div><div class="line">    <span class="attr">last5</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">let</span> keys = <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.nicknames).reverse().slice(<span class="number">0</span>, <span class="number">5</span>)</div><div class="line">      <span class="keyword">let</span> data = []</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">of</span> keys) &#123;</div><div class="line">        data.push(<span class="keyword">this</span>.nicknames[k])</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> data</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Try viewing the same url on two side-by-side windows to see what happens.</p>
<p>Thanks for reading, I hope it was of some use.</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/">async</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/feathers/">feathers</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leveldb/">leveldb</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/real-time/">real-time</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue2/">vue2</a><span class="tag-list-count">1</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/posts/Securing-Access-to-a-Feathers-Service-with-JWT-tokens/"><i class="icon icon-arror-left"></i></a></li><li><a href="/posts/a-very-simple-http-post-tool/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://www.linkedin.com/in/col-wilson-bb49249/" title="linkedin" target="_blank"><i class="icon icon-linkin"></i></a></li><li><a href="mailto:tersecol+wwwdotcomslash@gmail.com" title="email" target="_blank"><i class="icon icon-email"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 Profound<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>